# AWS App Runner configuration for Jiraibrary backend
version: 1.0

services:
  - name: jiraibrary-backend
    sourceConfiguration:
      imageRepository:
        imageIdentifier: 789924422625.dkr.ecr.us-east-2.amazonaws.com/jiraibrary-backend:latest
        imageRepositoryType: ECR
        imageConfiguration:
          port: 8000
          runtimeEnvironmentVariables:
            DJANGO_SETTINGS_MODULE: config.settings
            PYTHONUNBUFFERED: "1"
            PYTHONDONTWRITEBYTECODE: "1"
            AWS_S3_MEDIA_LOCATION: media
          runtimeEnvironmentSecrets:
            DATABASE_URL: arn:aws:secretsmanager:us-east-2:789924422625:secret:prod/jiraibrary/database
            SECRET_KEY: arn:aws:secretsmanager:us-east-2:789924422625:secret:prod/jiraibrary/secret-key
    instanceConfiguration:
      cpu: 1024
      memory: 2048
    healthCheckConfiguration:
      protocol: HTTP
      path: /admin/login/
      interval: 10
      timeout: 5
      healthyThreshold: 5
      unhealthyThreshold: 3
    autoScalingConfigurationArn: arn:aws:apprunner:us-east-2:789924422625:autoscalingconfiguration/jiraibrary-backend-default
